---
layout: post
title:  "google tag manager 세팅하기"
categories: marketing
---

# Google Tag Manager

<https://marketingplatform.google.com/about/tag-manager/>

## 태그

처음에는 태그의 개념이 잡히지 않아서 이해하기 어려웠다. 
태그란, Google Analytics, Facebook Pixel, Hotjar 등의 마케팅 분석 툴 서비스에서 제공하는 추적 코드라고 이해하면 된다. 
Google Analytics 등을 설치할 때 head에 붙여넣으라고 주는 script 코드가 그 예이다. 

참고: <https://support.google.com/tagmanager/answer/3281060?hl=en>

## 태그 매니지먼트 시스템

태그 매니지먼트 시스템은 태그를 관리하기 위한 시스템이다. 
페이지 뷰 추적, 클릭 추적, 구매 추적 등을 위한 태그를 통합 관리하도록 도와준다. 

참고: <https://en.wikipedia.org/wiki/Tag_management_system>

## Google Tag Manager

Google Tag Manager는 구글에서 제공하는 태그 매니지먼트 시스템이다. 
이하 GTM. 
GTM을 활용하면, 개발자의 적은 도움만으로도 다양한 태그 관리가 가능하다고 한다. 
Google Analytics, Google Ads 등 Google이 제공하는 Tag 서비스들의 태그 관리를 제공한다. 
그 외에도 제휴가 되어있는 서비스들의 태그 관리를 사용할 수 있다. 

회사에서는 GTM을 GA 이벤트 추적 용도로 사용하고 있다. 

# 컨테이너 만들기

GTM에서는 하나의 프로젝트를 하나의 컨테이너에 담는다. 
일단, 컨테이너를 만들고 세팅을 한다. 

## 1. 회원 가입 & 컨테이너를 만든다.

컨테이너 만들기를 누른 후 추적하려는 제품의 이름, 유형을 선택한다. 

## 2. 코드 삽입

구글 어낼리틱스처럼 추적하고자 하는 곳에 코드를 붙여넣는다. 
총 두 개의 코드를 넣어야 한다. 
하나는 script 코드, 하나는 noscript 코드이다. 

여기까지 하면 생성 완료.

# Google Analytics 세팅

GTM으로 관리할 첫 태그로 Google Analytics를 셋업한다. 

## 1. 변수 생성

1. [변수] 클릭
2. [사용자 정의 변수] > [새로 만들기] 클릭
3. 변수의 이름을 지어준다. 예를 들면 GA 이런 식으로 만든다.
4. [변수 구성] 클릭 > [변수 유형 선택]에서 [Google 애널리틱스 설정] 클릭
4. 추적 ID: 본인이 설치해놓은 추적 ID를 적는다.

## 2. 태그 생성

1. [태그] > [새로만들기] > [태그 구성] > [Google 애널리틱스: 유니버설 애널리틱스] 클릭
2. 추적 유형: 페이지뷰
3. [Google 애널리틱스 설정] > 아까 만든 변수 클릭

참고: <https://support.google.com/tagmanager/answer/6107124?hl=ko&ref_topic=6333310>

## 3. 기존 코드에서 GA 코드 삭제

GA 코드와 GTM 코드가 둘 다 있으면 중복 집계 문제가 생긴다. 
GA 코드는 삭제하도록 한다. 

## 미리보기

우측 상단의 [미리보기]를 클릭하고 웹 브라우저에서 본인의 프로젝트 웹 사이트에 가면 하단에 GTM 콘솔이 뜬다. 
(웹 프로젝트 기준) 
이 곳에서 실제 태그들이 동작하는지 확인할 수 있다. 

## 제출

미리보기에서 제대로 된 동작을 확인했다면, 우측 상단의 [제출]을 클릭해서 실제 서비스에 적용하도록 한다. 
[제출] > [버전 게시 및 만들기]을 통해 적용할 수 있다. 

# GTM의 구성

GTM은 컨테이너 안에 태그, 트리거, 변수를 가지고 있다. 
이 셋만 파악한다면, 본인이 필요로 하는 태그를 만들 수 있다. 

## 변수

말 그대로 variables. 
자주 사용하는 값들을 저장해 놓는다. 
위에서 GA의 변수를 만든 것이 사용 예시이다. 

## 트리거

트리거는 GTM이 특정 이벤트가 일어났다고 판단하도록 해준다. 
GA 이벤트를 사용할 때는 트리거를 설정해서 사용한다. 
[새로 만들기] > [트리거 구성]에서 본인 상황에 맞는 트리거를 선택해서 만들어준다. 

가장 많이 쓰이는 것으로는 [클릭]이 있다. 
이 때 링크 클릭이라면 [클릭 - 링크만]을 선택, 요소 클릭이라면 [클릭 - 모든 요소]를 선택한다. 

## 태그

추적. 
태그를 만들어야 실제 추적이 시작된다. 
위에서 GA의 태그를 만들었기때문에, GA 추적코드가 실행이 된 것이다. 
트리거와 변수는 아무리 만들어도 실제 추적이 시작되지 않는다. 
카테고리, 작업, 라벨은 회사에 맞게 사용한다. 
작업은 action의 번역으로, click, scroll, play, submit 등을 사용하면 된다. 

# 사용 예시

모든 링크 클릭 이벤트를 트래킹을 하려고 한다. 
클릭하는 html id를 값으로 기록하고자 한다. 

1. [트리거] > [새로 만들기]
2. [클릭] > [링크만]
3. 트리거 저장
4. [태그] > [새로 만들기]
5. [태그 유형 - Google 애널리틱스: 유니버설 애널리틱스]<br>
추적 유형: 이벤트<br>
카테고리: link<br>
작업: click<br>
라벨: link-click<br>
값: \{\{Click ID\}\} (블락모양을 선택해 본인이 필요로 하는 요소들을 사용할 수 있다)<br>
Google 애널리틱스 설정: 본인이 만들어 놓은 설정 사용
6. [트리거] - 아까 만들어 놓은 트리거 선택
7. 태그 저장
8. 미리보기 테스트 후 제출
9. 시간이 지난 뒤 GA [행동] > [이벤트]에서 제대로 추적되는지 확인

# 참고

* <https://marketingplatform.google.com/about/tag-manager/>